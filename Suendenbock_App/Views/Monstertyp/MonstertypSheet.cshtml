@using Suendenbock_App.Models.Domain
@model Monstertyp
@{
    // Prüfen ob User Admin/God ist
    var isAdmin = User.IsInRole("Gott");
    Layout = isAdmin ? "_AdminLayout" : "_Layout";
}
@section Styles {
    <link href="/css/antique-home.css" rel="stylesheet" />
    <link href="/css/character.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Uncial+Antiqua&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
}
<div class="steckbrief-container">
    <div class="steckbrief-title">@Model.Name</div>
    <div class="row mt-5">
        <div class="col-md-6">
            <p>Hier kommt die Erklärung zum Monstertyp</p>
            <p>
                @Model.Description
            </p>
        </div>
    </div>
    <div class="row mt-5">
        <div class="col-md-4">
            <div class="pergament-card" data-tilt>
                <div class="card-corner top-left"></div>
                <div class="card-corner top-right"></div>
                <div class="card-corner bottom-left"></div>
                <div class="card-corner bottom-right"></div>
                <h3 class="card-title">Intelligenz</h3>
                <div class="card-content">@Model.Monsterintelligenz.Name</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="pergament-card" data-tilt>
                <div class="card-corner top-left"></div>
                <div class="card-corner top-right"></div>
                <div class="card-corner bottom-left"></div>
                <div class="card-corner bottom-right"></div>
                <h3 class="card-title">Gruppe</h3>
                <div class="card-content">@Model.Monstergruppen.Name</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="pergament-card" data-tilt>
                <div class="card-corner top-left"></div>
                <div class="card-corner top-right"></div>
                <div class="card-corner bottom-left"></div>
                <div class="card-corner bottom-right"></div>
                <h3 class="card-title">Würfel </h3>
                <div class="card-content">@Model.Monsterwuerfel.Wuerfel</div>
            </div>
        </div>
    </<div>
    <div class="row mt-5">
        <div class="col-md-4">
            <div class="pergament-card" data-tilt>
                <div class="card-corner top-left"></div>
                <div class="card-corner top-right"></div>
                <div class="card-corner bottom-left"></div>
                <div class="card-corner bottom-right"></div>
                <h3 class="card-title">Immunitaeten </h3>
                <div class="card-content">
                    @(Model.MonstertypImmunitaeten?.Any() == true ?
                                        string.Join(", ", Model.MonstertypImmunitaeten.Select(mi => mi.Monsterimmunitaeten?.Name ?? "Unbekannt")) :
                                        "Keine")
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="pergament-card" data-tilt>
                <div class="card-corner top-left"></div>
                <div class="card-corner top-right"></div>
                <div class="card-corner bottom-left"></div>
                <div class="card-corner bottom-right"></div>
                <h3 class="card-title">Vorkommen<br /></h3>
                <div class="card-content">
                    @(Model.MonstertypenVorkommen?.Any() == true ?
                                        string.Join(", ", Model.MonstertypenVorkommen.Select(mi => mi.Monstervorkommen?.Name ?? "Unbekannt")) :
                                        "Keine")
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="pergament-card" data-tilt>
                <div class="card-corner top-left"></div>
                <div class="card-corner top-right"></div>
                <div class="card-corner bottom-left"></div>
                <div class="card-corner bottom-right"></div>
                <h3 class="card-title">Anfällig<br /></h3>
                <div class="card-content">
                        @(Model.MonstertypAnfaelligkeiten?.Any() == true ?
                                                    string.Join(", ", Model.MonstertypAnfaelligkeiten.Select(mi => mi.Monsteranfaelligkeiten?.Name ?? "Unbekannt")) :
                                                    "Keine")
                </div>
            </div>
        </div>
    </div>    
</div>
</div>
        @if (User.Identity?.IsAuthenticated == true)
        {
            var allMonsters = Model.Monster?.ToList();
            var encounteredCount = allMonsters?.Count(m => m.encounter) ?? 0;
            if (allMonsters != null && allMonsters.Any())
            {
                <div class="mt-5 pergament-card" data-tilt>
                    <div class="card-corner top-left"></div>
                    <div class="card-corner top-right"></div>
                    <div class="card-corner bottom-left"></div>
                    <div class="card-corner bottom-right"></div>
                    <h3 class="card-title">👹 Monster (@encounteredCount/@allMonsters.Count entdeckt)<br /></h3>
                    <div class="card-content">
                        <div class="row">
                            @foreach (var monster in allMonsters)
                            {
                                var isLocked = !monster.encounter;
                                <div class="col-md-4 mb-3">
                                    <div class="monster-encounter-card" style="background: linear-gradient(145deg, #faf8f3, #f0e6d2); border: 2px solid @(isLocked ? "#8b7355" : "#d4c4a8"); border-radius: 8px; padding: 1rem; text-align: center; @(isLocked ? "opacity: 0.7;" : "")">
                                        @if (!string.IsNullOrEmpty(monster.ImagePath))
                                        {
                                            <img src="@monster.ImagePath" alt="@(isLocked ? "???" : monster.Name)" style="width: 60px; height: 60px; border-radius: 50%; border: 2px solid @(isLocked ? "#6b5345" : "#d4af37"); margin-bottom: 0.5rem; @(isLocked ? "filter: blur(8px) grayscale(100%);" : "")">
                                        }
                                        else
                                        {
                                            <div style="width: 60px; height: 60px; border-radius: 50%; border: 2px solid @(isLocked ? "#6b5345" : "#d4c4a8"); background: linear-gradient(45deg, #8b7355, #6b5345); display: flex; align-items: center; justify-content: center; margin: 0 auto 0.5rem; font-size: 1.5rem; @(isLocked ? "filter: blur(4px);" : "")">
                                                @(isLocked ? "🔒" : "👹")
                                            </div>
                                        }
                                        <h5 style="font-family: 'Cinzel', serif; color: #5d4e37; margin: 0.5rem 0; @(isLocked ? "filter: blur(5px);" : "")">
                                            @(isLocked ? "???" : monster.Name)
                                        </h5>
                                        @if (!isLocked && monster.perfected)
                                        {
                                            <span style="background: linear-gradient(45deg, #d4af37, #b8941f); color: white; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.75rem;">
                                                ✨ Komplett erforscht
                                            </span>
                                        }
                                        @if (isLocked)
                                        {
                                            <span style="background: linear-gradient(45deg, #6b5345, #4a3829); color: #d4c4a8; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.75rem;">
                                                🔒 Nicht freigeschaltet
                                            </span>
                                        }
                                    </div>
                                </div>
                            }
                        </div>
                        <div class="text-center mt-3">
                            <a href="@Url.Action("PlayerOverview", "Monster")" class="btn btn-primary" style="background: linear-gradient(45deg, #d4af37, #b8941f); border: none;">
                                📖 Zum vollständigen Monster-Kompendium
                            </a>
                        </div>
                    </div>
                </div>
            }
        }
