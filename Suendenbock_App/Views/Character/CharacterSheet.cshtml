@using Suendenbock_App.Models.Domain
@model Character
@section Styles {
    <link href="/css/wiki.css" rel="stylesheet" />
    <style>
        .character-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 0;
        }
        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        .nav-button:hover {
            background: linear-gradient(45deg, #764ba2, #667eea);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .nav-button:disabled,
        .nav-button.disabled {
            background: #ccc;
            color: #666;
            cursor: not-allowed;
            pointer-events: none;
        }
        .back-to-overview {
            padding: 8px 16px;
            background: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        .back-to-overview:hover {
            background: #5a6268;
            color: white;
            transform: translateY(-2px);
        }
    </style>
}

<!-- Navigation -->
<div class="character-navigation container">
    <div>
        @if (ViewBag.HasPrevious)
        {
            <a class="nav-button"
               asp-controller="Character"
               asp-action="CharacterSheet"
               asp-route-id="@ViewBag.PreviousId"
               asp-route-searchTerm="@ViewBag.SearchTerm"
               asp-route-characterIds="@ViewBag.CharacterIds">
                <i class="bi bi-arrow-left"></i> Vorheriger
            </a>
        }
        else
        {
            <span class="nav-button disabled">
                <i class="bi bi-arrow-left"></i> Vorheriger
            </span>
        }
    </div>

    <div>
        <a class="back-to-overview"
           asp-controller="Character"
           asp-action="Overview"
           asp-route-searchTerm="@ViewBag.SearchTerm">
            <i class="bi bi-grid-3x3"></i> Zurück zur Übersicht
        </a>
    </div>

    <div>
        @if (ViewBag.HasNext)
        {
            <a class="nav-button"
               asp-controller="Character"
               asp-action="CharacterSheet"
               asp-route-id="@ViewBag.NextId"
               asp-route-searchTerm="@ViewBag.SearchTerm"
               asp-route-characterIds="@ViewBag.CharacterIds">
                Nächster <i class="bi bi-arrow-right"></i>
            </a>
        }
        else
        {
            <span class="nav-button disabled">
                Nächster <i class="bi bi-arrow-right"></i>
            </span>
        }
    </div>
</div>

<div class="wiki-container">
    <div class="wiki-header">
        @if (!string.IsNullOrEmpty(Model.ImagePath))
        {
            <img src="@Model.ImagePath" alt="@Model.Vorname @Model.Nachname" class="wiki-avatar">
        }
        else
        {
            <div class="wiki-avatar" style="background: linear-gradient(45deg, #d4af37, #b8941f); display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                @Model.Vorname.FirstOrDefault()@Model.Nachname.FirstOrDefault()
            </div>
        }

        <div>
            <h1 class="wiki-title">@Model.Vorname @Model.Nachname</h1>
            <p class="wiki-subtitle">
                @Model.Rasse.Name • @Model.Lebensstatus.Name • @Model.Eindruck.Name
            </p>
        </div>
    </div>

    <div class="wiki-content">
        <div class="wiki-main">
            <h3>📜 Charakterbeschreibung</h3>
            <div class="wiki-description">
                @if (!string.IsNullOrEmpty(Model.Details?.Description))
                {
                    @Html.Raw(Model.Details.Description)
                }
                else
                {
                    <em class="text-muted">Keine Beschreibung verfügbar.</em>
                }
            </div>
        </div>

        <div class="wiki-sidebar">
            <div class="wiki-infobox">
                <h4>📊 Charakterdaten</h4>
                <p><strong>Rufname:</strong> @Model.Rufname</p>
                <p><strong>Geschlecht:</strong> @Model.Geschlecht</p>
                @if (!string.IsNullOrEmpty(Model.Geburtsdatum))
                {
                    <p><strong>Geboren:</strong> @Model.Geburtsdatum</p>
                }
                <p>
                    <strong>Magie:</strong>
                    @if (Model.IsUnbegabt)
                    {
                        <div style="margin-left: 10px; margin-top: 5px;">
                            <span class="badge" style="background: linear-gradient(45deg, #666, #888); color: white; font-size: 0.9em;">
                                ⛔ Unbegabt
                            </span>
                            <div style="font-size: 0.85em; color: #999; margin-top: 5px;">
                                <em>Dieser Charakter besitzt keine magischen Fähigkeiten.</em>
                            </div>
                        </div>
                    }
                    else if (Model.CharacterMagicClasses.Any())
                    {
                        <div style="margin-top: 8px;">
                            @foreach (var cmc in Model.CharacterMagicClasses)
                            {
                                <div style="margin-left: 10px; font-size: 0.9em; color: #666; margin-bottom: 8px;">
                                    @(cmc.MagicClass?.Obermagie?.Bezeichnung) → @(cmc.MagicClass?.Bezeichnung)

                                    @if (Model.Profan || Model.Beschraenkt)
                                    {
                                        <span style="color: #999; margin-left: 8px;">
                                            @if (Model.Profan)
                                            {
                                                <span class="badge" style="background: linear-gradient(45deg, #8b4513, #a0522d); color: white; font-size: 0.85em;">
                                                    Profan
                                                </span>
                                            }
                                            else if (Model.Beschraenkt)
                                            {
                                                <span class="badge" style="background: linear-gradient(45deg, #d2691e, #cd853f); color: white; font-size: 0.85em;">
                                                    Beschränkt
                                                </span>
                                            }
                                            <em>(Keine Spezialisierung)</em>
                                        </span>
                                    }
                                    else if (cmc.MagicClassSpecialization != null)
                                    {
                                        <span>→ <strong>@cmc.MagicClassSpecialization.Name</strong></span>
                                    }
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <span class="text-muted">Keine Magieklassen zugewiesen</span>
                    }
                </p>
                @if (!string.IsNullOrEmpty(Model.Details?.Beruf))
                {
                    <p><strong>Beruf:</strong> @Model.Details.Beruf</p>
                }
                @if (Model.Details?.Haus != null)
                {
                    <p><strong>Haus:</strong> @Model.Details.Haus.Name</p>
                }
                @if (Model.Details?.Herkunftsland != null)
                {
                    <p><strong>Herkunft:</strong> @Model.Details.Herkunftsland.Name</p>
                }
                @if (Model.Vater != null || Model.Mutter != null)
                {
                    <p><strong>Eltern:</strong>
                        @if (Model.Vater != null)
                        {
                            <div style="margin-left: 10px; font-size: 0.9em; color: #666;">
                                Vater: <a asp-controller="Character"
                                          asp-action="CharacterSheet"
                                          asp-route-id="@Model.Vater.Id"
                                          style="color: #0066cc; text-decoration: none;">
                                    @Model.Vater.Vorname @Model.Vater.Nachname
                                </a>
                            </div>
                        }
                        @if (Model.Mutter != null)
                        {
                            <div style="margin-left: 10px; font-size: 0.9em; color: #666;">
                                Mutter: <a asp-controller="Character"
                                           asp-action="CharacterSheet"
                                           asp-route-id="@Model.Mutter.Id"
                                           style="color: #0066cc; text-decoration: none;">
                                    @Model.Mutter.Vorname @Model.Mutter.Nachname
                                </a>
                            </div>
                        }
                    </p>
                }
                @if (Model.Partner != null)
                {
                    <p><strong>Partner:</strong>
                        <a asp-controller="Character"
                           asp-action="CharacterSheet"
                           asp-route-id="@Model.Partner.Id"
                           style="color: #0066cc; text-decoration: none;">
                            @Model.Partner.Vorname @Model.Partner.Nachname
                        </a>
                    </p>
                }
                @if (Model.Details?.Blutgruppe != null)
                {
                    <p><strong>Blut:</strong> @Model.Details.Blutgruppe.Name</p>
                }
                @if (Model.Affiliation?.Guild != null)
                {
                    <p><strong>Gilde:</strong> @Model.Affiliation.Guild.Name</p>
                }
                @if (Model.Affiliation?.Regiment != null)
                {
                    <p><strong>Regiment:</strong> @Model.Affiliation.Regiment.Name</p>
                }
                @if (Model.Affiliation?.Infanterierang != null)
                {
                    <p><strong>Infanterierang:</strong> @Model.Affiliation.Infanterierang.Name</p>
                }
            </div>

            
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/character-mentions.js"></script>
}