@using Suendenbock_App.Models.Domain
@model Character
@section Styles {
    <link href="/css/wiki.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Uncial+Antiqua&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
}

<div class="wiki-container">
    <div class="wiki-header">
        @if (!string.IsNullOrEmpty(Model.ImagePath))
        {
            <img src="@Model.ImagePath" alt="@Model.Vorname @Model.Nachname" class="wiki-avatar">
        }
        else
        {
            <div class="wiki-avatar" style="background: linear-gradient(45deg, #d4af37, #b8941f); display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                @Model.Vorname.FirstOrDefault()@Model.Nachname.FirstOrDefault()
            </div>
        }

        <div>
            <h1 class="wiki-title">@Model.Vorname @Model.Nachname</h1>
            <p class="wiki-subtitle">
                @Model.Rasse.Name • @Model.Lebensstatus.Name
                @if (Model.CharacterMagicClasses.Any())
                {
                    <span> • @string.Join(", ", Model.CharacterMagicClasses.Select(cmc => cmc.MagicClass?.Bezeichnung))</span>
                }
            </p>
        </div>
    </div>

    <div class="wiki-content">
        <div class="wiki-main">
            <h3>📜 Charakterbeschreibung</h3>
            <div class="wiki-description">
                @* NEU: Verarbeitete Description mit Links anzeigen *@
                @if (!string.IsNullOrEmpty(Model.Details?.ProcessedDescription))
                {
                    @Html.Raw(Model.Details.ProcessedDescription)
                }
                else if (!string.IsNullOrEmpty(Model.Details?.Description))
                {
                    @Model.Details.Description
                }
                else
                {
                    <em class="text-muted">Keine Beschreibung verfügbar.</em>
                }
            </div>
        </div>

        <div class="wiki-sidebar">
            <div class="wiki-infobox">
                <h4>📊 Charakterdaten</h4>
                <p><strong>Rufname:</strong> @Model.Rufname</p>
                <p><strong>Geschlecht:</strong> @Model.Geschlecht</p>
                @if (!string.IsNullOrEmpty(Model.Geburtsdatum))
                {
                    <p><strong>Geboren:</strong> @Model.Geburtsdatum</p>
                }
            </div>

            @* Weitere Infoboxen für Magie, Familie etc. *@
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/character-mentions.js"></script>
}