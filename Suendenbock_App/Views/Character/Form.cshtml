@using Suendenbock_App.Models.Domain
@model Character
@{
    ViewData["Title"] = "Charakter erstellen";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Styles {
<link href="/css/character.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Uncial+Antiqua&display=swap" rel="stylesheet">
}
<div class="steckbrief-background">
    <div class="steckbrief-container">
        <div class="steckbrief-title">Charakter</div>
        <form asp-controller="Character" asp-action="CreateEdit">
            <div class="mt-5 mb-3">
                <label for="vorname" class="form-label">Vorname</label>
                <input type="text" class="form-control" id="vorname" name="vorname" required>
            </div>

            <div class="mb-3">
                <label for="nachname" class="form-label">Nachname</label>
                <input type="text" class="form-control" id="nachname" name="nachname" required>
            </div>

            <div class="mb-3">
                <select class="form-select" id="geschlecht" name="geschlecht">
                    <option value="" disabled selected hidden>Geschlecht auswählen...</option>
                    <option value="männlich">männlich</option>
                    <option value="weiblich">weiblich</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="geburtsdatum" class="form-label">Geburtsdatum</label>
                <input type="date" class="form-control" id="geburtsdatum" name="geburtsdatum">
            </div>

            <div class="mb-3">
                <label class="form-label">Magieklassen</label>
                <div class="card p-3">
                    <div class="row">
                        @foreach (var magicclass in ViewBag.MagicClasses)
                        {
                            bool isSelected = false;

                            // Prüfe, ob das Array existiert und nicht null ist
                            if (ViewBag.SelectedMagicClasses != null)
                            {
                                // Durchlaufe die ausgewählten IDs und prüfe, ob die aktuelle MagicClass enthalten ist
                                foreach (var id in ViewBag.SelectedMagicClasses)
                                {
                                    if (id.Equals(magicclass.Id))
                                    {
                                        isSelected = true;
                                        break;
                                    }
                                }
                            }

                            <div class="col-md-4 col-sm-6 mb-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox"
                                    name="selectedMagicClasses"
                                    value="@magicclass.Id"
                                    id="magic-@magicclass.Id"
                                    @(isSelected ? "checked" : "")>
                                    <label class="form-check-label" for="magic-@magicclass.Id">
                                        @magicclass.Bezeichnung
                                    </label>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">Spezialisierung</label>
                <div class="card p-3">
                    <div class="row specializations-container">
                        @foreach (var specialization in ViewBag.Specializations)
                        {
                            <div class="col-md-4 col-sm-6 mb-2 specialization-item" 
                                data-magic-class-id="@specialization.MagicClassId" style="display:none;">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" 
                                        name="specializationId_@specialization.MagicClassId"
                                        value="@specialization.Id"
                                        id="spec-@specialization.Id" />
                                    <label class="form-check-label" for="spec-@specialization.Id">
										@specialization.Name
                                    </label>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <select class="form-select" id="guildId" name="guildId">
                    <option value="" disabled selected hidden>Gilde auswählen...</option>
                    @{
                        foreach (var guild in ViewBag.Guilds)
                        {
                            <option value="@guild.Id">@guild.Name</option>
                        }
                    }
                </select>
            </div>

            <div class="mb-3">
                <select class="form-select" id="religionId" name="religionId">
                    <option value="" disabled selected hidden>Religion auswählen...</option>
                    @{
                        foreach (var religion in ViewBag.Religions)
                        {
                            <option value="@religion.Id">@religion.Type</option>
                        }
                    }
                </select>
            </div>

            <div class="text-center">
                <button type="submit" class="btn-wachs">Gebilligt</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
		$(document).ready(function() {
            function toggleSpecializations() {
                $('.specialization-item').hide();
				$('input[name="selectedMagicClasses"]:checked').each(function() {
					var magicClassId = $(this).val();
					$('.specialization-item[data-magic-class-id="' + magicClassId + '"]').show();
				});
            }

			toggleSpecializations();

			$('input[name="selectedMagicClasses"]').change(function() {
				toggleSpecializations();
			});
		});
	</script>
}