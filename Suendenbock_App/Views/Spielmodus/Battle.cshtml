@model Suendenbock_App.Controllers.BattleViewModel
@{
    ViewData["Title"] = "Kampf";
}

@section Styles {
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=MedievalSharp&display=swap" rel="stylesheet" />

    <!-- Battle CSS -->
    <link rel="stylesheet" href="~/css/spielmodus-battle.css" />
}

<div class="min-h-screen flex flex-col items-center p-4 md:p-8 bg-[#0a0a0a] text-gray-100 overflow-x-hidden relative font-['Cinzel']" id="battleContainer">
    <!-- Background Effect -->
    <div class="fixed inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-red-900/10 via-black to-black opacity-90 pointer-events-none"></div>

    <main class="relative z-10 w-full max-w-6xl flex flex-col items-center">

        <!-- ===== BATTLE GRID SCREEN ===== -->
        <section class="w-full space-y-6 animate-in fade-in duration-700" id="battleGridScreen">
            <!-- Header -->
            <header class="text-center mb-6 bg-black/40 border border-amber-500/20 rounded-lg p-6 shadow-[0_0_20px_rgba(245,158,11,0.2)]">
                <h1 class="text-5xl font-medieval uppercase tracking-[0.3em] text-amber-500 drop-shadow-[0_0_10px_rgba(245,158,11,0.5)] font-bold" id="roundTitle">
                    Runde <span id="currentRound" class="text-6xl">1</span>
                </h1>
                <p class="text-amber-300/80 italic mt-3 text-xl tracking-wide" id="turnIndicator">Initiative wird berechnet...</p>
            </header>

            <!-- Participants Grid -->
            <div class="bg-white/5 border border-white/10 rounded-lg shadow-2xl overflow-hidden backdrop-blur-sm">
                <div class="p-4 space-y-4 max-h-[72vh] overflow-y-auto custom-scrollbar" id="participantsContainer">
                    <!-- Participants werden via JS erstellt -->
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col items-center pt-6 space-y-4">
                <button
                    onclick="nextTurn()"
                    class="group relative bg-amber-500 text-black px-24 py-6 font-display font-bold uppercase tracking-[0.4em] text-2xl shadow-[0_0_30px_rgba(245,158,11,0.4)] hover:shadow-[0_0_40px_rgba(245,158,11,0.6)] hover:scale-105 transition-all active:scale-95 rounded-lg border-2 border-amber-600">
                    <div class="absolute inset-0 bg-gradient-to-b from-white/20 to-transparent rounded-lg pointer-events-none"></div>
                    <span>Nächster Zug</span>
                </button>
                <button
                    onclick="endBattle()"
                    class="text-base text-amber-500/60 uppercase tracking-[0.3em] font-bold hover:text-amber-500 transition-colors">
                    Gefecht beenden
                </button>
            </div>
        </section>

        <!-- ===== VICTORY/DEFEAT SCREEN ===== -->
        <section class="w-full hidden" id="resultScreen">
            <div class="text-center space-y-8 animate-in fade-in duration-700">
                <div class="result-icon text-9xl" id="resultIcon"></div>
                <h1 class="text-6xl font-display uppercase tracking-widest" id="resultTitle"></h1>
                <p class="text-2xl text-white/60 italic" id="resultMessage"></p>

                <div class="flex justify-center gap-4 pt-8">
                    <a href="/Spielmodus/Dashboard" class="bg-amber-500 text-black px-12 py-4 font-display font-bold uppercase tracking-widest text-lg rounded hover:scale-105 transition-all">
                        <span class="material-symbols-outlined inline-block mr-2">fireplace</span>
                        Zurück zum Lager
                    </a>
                </div>
            </div>
        </section>
    </main>
</div>

@section Scripts {
    <!-- SignalR Client Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>

    <script>
        // Model-Daten für JavaScript (falls direkt aufgerufen ohne CombatSetup)
        const BATTLE_MODEL_DATA = {
            characters: @Html.Raw(Json.Serialize(Model.Characters)),
            monsters: @Html.Raw(Json.Serialize(Model.Monsters))
        };
    </script>
    <script src="~/js/battle.js"></script>

    <style>
        /* Custom Tailwind Colors */
        :root {
            --color-crimson: 128 0 32;
            --color-secondary: 212 175 55;
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(212, 175, 55, 0.5);
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(212, 175, 55, 0.8);
        }

        /* Animations */
        @@keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @@keyframes slide-in-from-top {
            from {
                opacity: 0;
                transform: translateY(-0.5rem);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fade-in 0.5s ease-out;
        }

        .slide-in-from-top-2 {
            animation: slide-in-from-top 0.3s ease-out;
        }

        /* Font Families */
        .font-medieval {
            font-family: 'MedievalSharp', cursive;
        }

        .font-display {
            font-family: 'Cinzel', serif;
        }
    </style>
}
