@model Suendenbock_App.Controllers.BattleViewModel
@{
    ViewData["Title"] = "Kampf";
}

@section Styles {
    <!-- Material Symbols Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <!-- Battle CSS -->
    <link rel="stylesheet" href="~/css/spielmodus.css" />
    <link rel="stylesheet" href="~/css/spielmodus-battle.css" />
}

<div class="battle-container" id="battleContainer">

    <!-- ===== SCREEN 1: MONSTER AUSWAHL ===== -->
    <div class="battle-screen active" id="monsterSelectScreen">
        <header class="battle-header">
            <h1>Wähle deinen Gegner</h1>
            <p class="subtitle">Die Bestien lauern im Schatten</p>
        </header>

        <div class="monster-grid">
            @foreach (var monster in Model.Monsters)
            {
                <div class="monster-card"
                     data-monster-id="@monster.Id"
                     data-monster-name="@monster.Name"
                     data-monster-health="@monster.Health"
                     data-monster-attack="@monster.Attack"
                     data-monster-defense="@monster.Defense"
                     data-monster-image="@monster.ImageUrl"
                     onclick="selectMonster(this)">

                    <!-- Monster Bild -->
                    <div class="monster-image">
                        <img src="@monster.ImageUrl" alt="@monster.Name" />
                        @if (monster.IsBoss)
                        {
                            <span class="boss-badge">
                                <span class="material-symbols-outlined">skull</span>
                                Boss
                            </span>
                        }
                    </div>

                    <!-- Monster Info -->
                    <div class="monster-info">
                        <h3 class="monster-name">@monster.Name</h3>
                        <p class="monster-type">@monster.MonstertypName</p>

                        <div class="monster-stats">
                            <div class="stat">
                                <span class="material-symbols-outlined">favorite</span>
                                <span>@monster.Health HP</span>
                            </div>
                            <div class="stat">
                                <span class="material-symbols-outlined">swords</span>
                                <span>@monster.Attack ATK</span>
                            </div>
                            <div class="stat">
                                <span class="material-symbols-outlined">shield</span>
                                <span>@monster.Defense DEF</span>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- Zurück Button -->
        <div class="screen-actions">
            <a href="/Spielmodus/Dashboard" class="battle-btn-secondary">
                <span class="material-symbols-outlined">arrow_back</span>
                <span>Zurück zum Lager</span>
            </a>
        </div>
    </div>

    <!-- ===== SCREEN 2: CHARACTER AUSWAHL ===== -->
    <div class="battle-screen" id="partySelectScreen">
        <header class="battle-header">
            <h1>Stelle deine Gruppe zusammen</h1>
            <p class="subtitle">Wähle bis zu 4 Helden</p>
        </header>

        <!-- Ausgewähltes Monster -->
        <div class="selected-monster-preview">
            <img id="previewMonsterImage" src="" alt="Monster" />
            <div>
                <h3 id="previewMonsterName">Monster</h3>
                <div class="monster-stats">
                    <span id="previewMonsterStats"></span>
                </div>
            </div>
        </div>

        <!-- Character Grid -->
        <div class="character-grid">
            @foreach (var character in Model.Characters)
            {
                <div class="character-card @(character.HealthPercent <= 0 ? "dead" : "")"
                     data-character-id="@character.Id"
                     data-character-name="@character.Name"
                     data-character-health="@character.CurrentHealth"
                     data-character-max-health="@character.MaxHealth"
                     onclick="toggleCharacter(this)">

                    <!-- HP Bar -->
                    <div class="character-hp-bar">
                        <div class="hp-fill" style="width: @(character.HealthPercent)%"></div>
                        <span class="hp-text">@character.CurrentHealth / @character.MaxHealth HP</span>
                    </div>

                    <!-- Name -->
                    <h3 class="character-name">@character.Name</h3>

                    @if (character.HealthPercent <= 0)
                    {
                        <p class="character-status-dead">Bewusstlos</p>
                    }
                    else if (character.HealthPercent < 30)
                    {
                        <p class="character-status-critical">Kritisch</p>
                    }

                    <!-- Selected Indicator -->
                    <div class="selected-indicator">
                        <span class="material-symbols-outlined">check_circle</span>
                    </div>
                </div>
            }
        </div>

        <!-- Actions -->
        <div class="screen-actions">
            <button class="battle-btn-secondary" onclick="backToMonsterSelect()">
                <span class="material-symbols-outlined">arrow_back</span>
                <span>Anderen Gegner wählen</span>
            </button>

            <button class="battle-btn-primary" id="startBattleBtn" disabled onclick="startBattle()">
                <span class="material-symbols-outlined">swords</span>
                <span>Kampf beginnen!</span>
            </button>
        </div>
    </div>

    <!-- ===== SCREEN 3: COMBAT ===== -->
    <div class="battle-screen" id="combatScreen">
        <!-- Combat UI wird via battle.js erstellt -->
    </div>

    <!-- ===== SCREEN 4: RESULT ===== -->
    <div class="battle-screen" id="resultScreen">
        <div class="result-content">
            <div class="result-icon" id="resultIcon"></div>
            <h1 class="result-title" id="resultTitle"></h1>
            <p class="result-message" id="resultMessage"></p>

            <div class="result-actions">
                <a href="/Spielmodus/Dashboard" class="battle-btn-primary">
                    <span class="material-symbols-outlined">fireplace</span>
                    <span>Zurück zum Lager</span>
                </a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Model-Daten für JavaScript
        const BATTLE_DATA = {
            characters: @Html.Raw(Json.Serialize(Model.Characters)),
            monsters: @Html.Raw(Json.Serialize(Model.Monsters))
        };
    </script>
    <script src="~/js/battle.js"></script>
}
