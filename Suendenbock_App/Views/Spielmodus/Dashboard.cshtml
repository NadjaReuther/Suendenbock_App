@model Suendenbock_App.Controllers.SpielmodusDashboardViewModel
@{
    ViewData["Title"] = "Spielmodus Dashboard";
}

<!-- Link zum Spielmodus-CSS im Head -->
@section Styles {
    <link rel="stylesheet" href="~/css/spielmodus.css" />
}

<!-- Main Content -->
<main class="main-content">

        <!-- Page Header -->
        <header class="page-header">
            <h1>Spielmodus</h1>
            <p class="subtitle" id="lastMessage">Willkommen in der Welt von 1618.</p>
        </header>

        <div class="content-wrapper">

            <!-- Action Cards mit Corner Brackets! -->
            <div class="action-grid">

                <!-- Karte -->
                <div class="pergament-card" data-tilt>
                    <a class="card-link" asp-controller="Spielmodus" asp-action="Map">
                    <div class="card-corner top-left"></div>
                    <div class="card-corner top-right"></div>
                    <div class="card-corner bottom-left"></div>
                    <div class="card-corner bottom-right"></div>

                    <div class="card-number">
                        <span class="material-symbols-outlined">map</span>
                    </div>
                    <h4 class="card-title">Karte</h4>
                    <div class="card-content">Erkunde das Reich</div>
                    </a>
                </div>

                <!-- Quests -->
                <div class="pergament-card" data-tilt>
                <a class="card-link" asp-controller="Spielmodus" asp-action="Quests">
                <div class="card-corner top-left"></div>
                <div class="card-corner top-right"></div>
                <div class="card-corner bottom-left"></div>
                <div class="card-corner bottom-right"></div>

                    <div class="card-number">
                        <span class="material-symbols-outlined">history_edu</span>
                    </div>
                    <h4 class="card-title">Quests</h4>
                    <div class="card-content">Deine Aufgaben</div>
                    </a>
                </div>

                <!-- Trophäen -->
                <div class="pergament-card" data-tilt>
                <a class="card-link" asp-controller="Spielmodus" asp-action="Trophies">
                <div class="card-corner top-left"></div>
                <div class="card-corner top-right"></div>
                <div class="card-corner bottom-left"></div>
                <div class="card-corner bottom-right"></div>

                    <div class="card-number">
                        <span class="material-symbols-outlined">skull</span>
                    </div>
                    <h4 class="card-title">Trophäen</h4>
                    <div class="card-content">Deine Erfolge</div>
                </a>
                </div>

            </div>

            <!-- Combat Button (nur für Gott) -->
            @if (Model.IsGod)
            {
                <div style="width: 100%; display: flex; justify-content: center;">
                    <button id="combatBtn" class="combat-button" onclick="goToCombatSetup()">
                    <span class="material-symbols-outlined icon" id="combatIcon">swords</span>
                    <span class="text" id="combatText">Kampfbereit Machen</span>
                    </button>
                </div>
            }

        <!-- Rest Buttons -->
        <div class="rest-buttons">
            <button class="rest-button" onclick="shortRest()">
                <span class="material-symbols-outlined">restaurant</span>
                <span>Kurze Rast</span>
            </button>

            <!--onclick="toggleCamp()" in button einbauen um Battle-System zu implementieren-->
            <button id="campBtn" class="rest-button camp">
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <span class="material-symbols-outlined" id="campIcon">fireplace</span>
                        <span id="campText">Nachtlager</span>
                    </div>
                    <span class="confirm-text" id="confirmText" style="display: none;">Bestätigen</span>
                </div>
            </button>
        </div>

            <!-- Wetter-Widget -->
            @if (Model.WeatherForecast != null && Model.WeatherForecast.Count >= 5)
            {
                <section class="weather-widget">
                    <div class="weather-container pergament-card" data-tilt>
                        <!-- Corner Brackets -->
                        <div class="card-corner top-left"></div>
                        <div class="card-corner top-right"></div>
                        <div class="card-corner bottom-left"></div>
                        <div class="card-corner bottom-right"></div>

                        <!-- Links: Vorgestern & Gestern -->
                        <div class="weather-past">
                            @for (int i = 0; i < 2; i++)
                            {
                                <div class="forecast-day">
                                    <span class="forecast-day-name">@Model.WeatherForecast[i].Day</span>
                                    <span class="material-symbols-outlined forecast-icon">@Model.WeatherForecast[i].Icon</span>
                                    <span class="forecast-temp">@Model.WeatherForecast[i].Temperature</span>
                                </div>
                            }
                        </div>

                        <!-- Mitte: Heute (groß) -->
                        <div class="weather-today">
                            <p class="weather-today-label">@Model.WeatherForecast[2].Day</p>
                            <div class="weather-today-main">
                                <span class="material-symbols-outlined weather-today-icon">@Model.WeatherForecast[2].Icon</span>
                                <div class="weather-today-temp">
                                    <p class="temp-high">@Model.WeatherForecast[2].Temperature.Split('/')[0]</p>
                                    <p class="temp-low">@Model.WeatherForecast[2].Temperature.Split('/')[1]</p>
                                </div>
                            </div>
                            @if (Model.CurrentAct != null && !string.IsNullOrEmpty(Model.CurrentAct.Weather))
                            {
                                <p class="weather-description">@Model.CurrentAct.Weather</p>
                            }
                        </div>

                        <!-- Rechts: Morgen & Übermorgen -->
                        <div class="weather-future">
                            @for (int i = 3; i < 5; i++)
                            {
                                <div class="forecast-day">
                                    <span class="forecast-day-name">@Model.WeatherForecast[i].Day</span>
                                    <span class="material-symbols-outlined forecast-icon">@Model.WeatherForecast[i].Icon</span>
                                    <span class="forecast-temp">@Model.WeatherForecast[i].Temperature</span>
                                </div>
                            }
                        </div>
                    </div>
                </section>
            }
            else
            {
                <section class="weather-widget">
                    <div class="weather-container pergament-card" data-tilt>
                        <!-- Corner Brackets -->
                        <div class="card-corner top-left"></div>
                        <div class="card-corner top-right"></div>
                        <div class="card-corner bottom-left"></div>
                        <div class="card-corner bottom-right"></div>

                        <p style="text-align: center; color: var(--ink); font-family: 'Cinzel', serif;">Wetterdaten nicht verfügbar.</p>
                    </div>
                </section>
            }

            

        </div>
    </main>

<!-- Camp Summary Modal -->
<div id="campModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-texture"></div>

        <div class="modal-header">
            <span class="material-symbols-outlined icon">fireplace</span>
            <h2>Das Nachtlager</h2>
            <p class="subtitle">Resümee der magischen Taten</p>
        </div>

        <div class="modal-body">
            <!-- Pokus Summary -->
            <div class="pokus-summary">
                <h3>Gesammelter Pokus</h3>
                <div class="pokus-grid" id="pokusGrid">
                    <!-- Wird via JavaScript gefüllt -->
                </div>
                <div class="pokus-total">
                    <span class="label">Gruppen-Gesamt</span>
                    <span class="value" id="totalPokus">0</span>
                </div>
            </div>

            <!-- Food Options -->
            <div class="food-section">
                <h3>Wähle dein Mahl:</h3>
                <div class="food-options" id="foodOptions">
                    <!-- Wird via JavaScript gefüllt -->
                </div>
            </div>

            <!-- Buttons -->
            <div class="modal-buttons">
                <button class="modal-button-primary" onclick="startRest()">
                    Rast beginnen & Kräfte sammeln
                </button>
                <button class="modal-button-secondary" onclick="closeCampModal()">
                    Zurück zum Dashboard
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <span class="material-symbols-outlined spinner">hourglass_empty</span>
    <p class="text">Die Zeit vergeht...</p>
</div>

<!-- JavaScript -->
@section Scripts {
    <script src="~/js/spielmodus-dashboard.js"></script>
    <script>
        // Initial Daten vom Server
        const initialCharacters = @Html.Raw(Json.Serialize(Model.ActiveCharacters));
        const initialRestFoods = @Html.Raw(Json.Serialize(Model.RestFoods));

        // Dashboard initialisieren
        window.addEventListener('DOMContentLoaded', () => {
            initDashboard(initialCharacters, initialRestFoods);

            // Tilt-Effekt für Pergament-Karten
            document.querySelectorAll('[data-tilt]').forEach(card => {
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;

                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;

                    const rotateX = (y - centerY) / 10;
                    const rotateY = (centerX - x) / 10;

                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.05, 1.05, 1.05)`;
                });

                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)';
                });
            });
        });
    </script>
}
