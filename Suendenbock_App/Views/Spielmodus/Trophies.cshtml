@model Suendenbock_App.Controllers.TrophiesViewModel
@{
    ViewData["Title"] = "Trophäen-Wand";
}

@section Styles {
    <!-- Dein CSS -->
    <link rel="stylesheet" href="~/css/spielmodus.css" />
    <link rel="stylesheet" href="~/css/spielmodus-trophies.css" />
}

<div class="spielmodus-trophies-container">

    <!-- Header -->
    
    <main class="trophies-main">

        <!-- SECTION 1: Ausgerüstete Trophäen (3 Slots) -->
        <section class="equipped-section">
            <div class="section-divider">
                <div class="divider-line"></div>
                <h2>Trophäenwand</h2>
                <div class="divider-line"></div>
            </div>

            <div class="equipped-grid">
                @for (int position = 1; position <= 3; position++)
                {
                    var trophy = Model.EquippedTrophies.FirstOrDefault(t => t.EquippedPosition == position);

                    <div class="trophy-slot drop-zone" data-position="@position">
                        <!-- Kette -->
                        <div class="trophy-chain"></div>
                        <div class="trophy-chain-mount"></div>

                        @if (trophy != null)
                        {
                            <!-- Ausgerüstete Trophäe -->
                            <div class="trophy-shield" data-trophy-id="@trophy.Id">
                                <!-- Schild-Hintergrund -->
                                <div class="shield-background">
                                    <div class="shield-texture"></div>
                                </div>

                                <!-- Bild im Kreis -->
                                <div class="shield-image-container">
                                    <img src="@trophy.ImagePath"
                                         alt="@trophy.Name"
                                         class="shield-image @(trophy.Status == "slain" ? "slain" : "bought")" />

                                    <!-- Hover: Entfernen-Icon -->
                                    <div class="shield-remove-overlay">
                                        <span class="material-symbols-outlined">close</span>
                                    </div>
                                </div>

                                <!-- Status Badge (klickbar wenn beide Varianten verfügbar) -->
                                @if (trophy.HasBothVariants)
                                {
                                    <button class="trophy-status-badge @trophy.Status clickable"
                                            data-trophy-id="@trophy.Id"
                                            data-current-status="@trophy.Status"
                                            title="Zwischen gekauft und erlegt wechseln"
                                            onclick="event.stopPropagation(); toggleTrophyType(@trophy.Id, '@trophy.Status')">
                                        <span class="material-symbols-outlined">
                                            @(trophy.Status == "slain" ? "skull" : "toll")
                                        </span>
                                    </button>
                                }
                                else
                                {
                                    <div class="trophy-status-badge @trophy.Status">
                                        <span class="material-symbols-outlined">
                                            @(trophy.HasSlainTrophy ? "skull" : "toll")
                                        </span>
                                    </div>
                                }
                            </div>

                            <!-- Namens-Plakette (Gold/Messing) -->
                            <div class="trophy-nameplate">
                                <div class="nameplate-inner">
                                    <h3 class="trophy-name">@trophy.Name</h3>
                                    <div class="nameplate-divider"></div>
                                    <p class="trophy-effect">
                                        @(trophy.Status == "slain" ? trophy.SlainEffect : trophy.BaseEffect)
                                    </p>
                                </div>
                            </div>
                        }
                        else
                        {
                            <!-- Leerer Slot -->
                            <div class="trophy-slot-empty">
                                <span class="material-symbols-outlined">add_circle</span>
                                <span class="empty-text">Platz frei</span>
                            </div>
                        }
                    </div>
                }
            </div>
        </section>

        <!-- Trenner -->
        <div class="content-divider">
            <div class="divider-line"></div>
            <span class="material-symbols-outlined">swords</span>
            <h2>In der Trophäen-Truhe</h2>
            <span class="material-symbols-outlined">swords</span>
            <div class="divider-line"></div>
        </div>

        <!-- SECTION 2: Inventory/Truhe -->
        <section class="inventory-section">
            

            @if (Model.InventoryTrophies.Any())
            {
                <div class="inventory-grid">
                    @foreach (var trophy in Model.InventoryTrophies)
                    {
                        <div class="inventory-card draggable" data-trophy-id="@trophy.Id" draggable="true">
                            <!-- Schild (kleiner) -->
                            <div class="inventory-shield">
                                <div class="shield-background-small"></div>
                                <div class="shield-image-container-small">
                                    <img src="@trophy.ImagePath"
                                         alt="@trophy.Name"
                                         class="shield-image-small @(trophy.Status == "slain" ? "slain" : "bought")" />
                                </div>

                                <!-- Status Badge (immer sichtbar) -->
                                <div class="status-badge-static @trophy.Status">
                                    <span class="material-symbols-outlined">
                                        @(trophy.Status == "slain" ? "skull" : "toll")
                                    </span>
                                </div>
                            </div>

                            <!-- Info -->
                            <h3 class="inventory-trophy-name">@trophy.Name</h3>
                            <div class="inventory-meta">
                                <p class="monster-type">@trophy.MonsterType</p>
                                <p class="status-label">
                                    @(trophy.Status == "slain" ? "Erlegt" : "Gekauft")
                                </p>
                            </div>

                            <!-- Verfügbare Varianten -->
                            <div class="trophy-variants">
                                <span class="variants-label">Erworbene Varianten:</span>
                                <div class="variant-badges">
                                    @if (trophy.HasBoughtTrophy)
                                    {
                                        <span class="variant-badge bought">
                                            <span class="material-symbols-outlined">toll</span>
                                            Gekauft
                                        </span>
                                    }
                                    @if (trophy.HasSlainTrophy)
                                    {
                                        <span class="variant-badge slain">
                                            <span class="material-symbols-outlined">skull</span>
                                            Erlegt
                                        </span>
                                    }
                                </div>
                            </div>

                            <div class="inventory-divider"></div>

                            <!-- Effekt-Anzeige -->
                            <div class="trophy-effects">
                                @if (trophy.HasBoughtTrophy && !string.IsNullOrEmpty(trophy.BaseEffect))
                                {
                                    <p class="effect-label">💰 Gekauft:</p>
                                    <p class="effect-text">@trophy.BaseEffect</p>
                                }
                                @if (trophy.HasSlainTrophy && !string.IsNullOrEmpty(trophy.SlainEffect))
                                {
                                    <p class="effect-label">🏆 Erlegt:</p>
                                    <p class="effect-text">@trophy.SlainEffect</p>
                                }
                            </div>

                            <!-- Monster-Beschreibungen (Collapsible) -->
                            <div class="monster-descriptions">
                                @if (trophy.Meet && !string.IsNullOrEmpty(trophy.Basics))
                                {
                                    <div class="description-section" data-trophy-id="@trophy.Id" data-section="basics">
                                        <p class="description-label">⚔️ Begegnung:</p>
                                        <div class="description-content">
                                            <span class="description-text">@Html.Raw(trophy.Basics)</span>
                                            <span class="description-toggle" onclick="toggleDescription(@trophy.Id, 'basics')"></span>
                                        </div>
                                    </div>
                                }
                                @if (trophy.Encounter && !string.IsNullOrEmpty(trophy.EncounterDescription))
                                {
                                    <div class="description-section" data-trophy-id="@trophy.Id" data-section="encounter">
                                        <p class="description-label">🎲 Encounter:</p>
                                        <div class="description-content">
                                            <span class="description-text">@Html.Raw(trophy.EncounterDescription)</span>
                                            <span class="description-toggle" onclick="toggleDescription(@trophy.Id, 'encounter')"></span>
                                        </div>
                                    </div>
                                }
                                @if (trophy.Perfected && !string.IsNullOrEmpty(trophy.ProcessedDescription))
                                {
                                    <div class="description-section" data-trophy-id="@trophy.Id" data-section="perfected">
                                        <p class="description-label">✨ Perfected:</p>
                                        <div class="description-content">
                                            <span class="description-text">@Html.Raw(trophy.ProcessedDescription)</span>
                                            <span class="description-toggle" onclick="toggleDescription(@trophy.Id, 'perfected')"></span>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <!-- Empty State -->
                <div class="inventory-empty">
                    <span class="material-symbols-outlined">inventory_2</span>
                    <p>Die Truhe ist leer.</p>
                </div>
            }
        </section>

        <!-- Zurück Button -->
        <section class="trophies-back">
            <a href="/Spielmodus/Dashboard" class="back-btn">
                <span class="material-symbols-outlined">fireplace</span>
                <div>
                    <span class="back-text">Zurück zum Lager</span>
                    <span class="back-subtext">Legt die Ausrüstung ab</span>
                </div>
            </a>
        </section>

    </main>

    <footer class="trophies-footer">
        <p>Unvergänglicher Ruhm im Jahre 1618</p>
    </footer>
</div>

@section Scripts {
    <script src="~/js/trophies.js"></script>
}
